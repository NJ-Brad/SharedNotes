# Entity Framework Tips
After creating a new scaffolded controller 

!!!>Note
This is how you create a scaffolded cntroller: 
Select the controllers folder in you Web API project.
Right click and select Add
Select New scaffolded Item...
Select API Controller with actions, using Entity Framework
Follow the prompts to select the model and contextr
!!!

## Use DbContextFactory
This will greatly shorten the lifetime on a context and will improve the multi-threading reliability.
### Step 1
In your dependency injection configuration, change from 
```
builder.Services.AddDbContext ...
```
to
```
builder.Services.AddDbContextFactory<[context class name]>();
```
If AddDbContext is not present, add the above.
### Step 2
In your controller, replace the data context variable
```
private readonly [contextClassName] _context;
```
with
```
private readonly IDbContextFactory<[contextClassName]> _contextFactory = null;
```
### Step 3
Modify the constructor of you controller
Replace in the constructor parameters
```
[contextClassName] context
```
with
```
IDbContextFactory<[contextClassName]> contextFactory
```

Replace 
```
_context = context;
```
with
```
_contextFactory = contextFactory;
```

### Step 4
Wrap all uses of ```_context``` in your class with
```
using ([contextClassName] _context = _contextFactory.CreateDbContext())
{
...
}
```

[DbContext Lifetime, Configuration, and Initialization - EF Core | Microsoft Learn](https://learn.microsoft.com/en-us/ef/core/dbcontext-configuration/ "DbContext Lifetime, Configuration, and Initialization - EF Core | Microsoft Learn")
