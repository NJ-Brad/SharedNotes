# Modernizing a WinForms Application

## Basic Requirements

### Packages
Add the following NuGet packages to the project
```csharp
Install-package Microsoft.Extensions.DependencyInjection
Install-package Microsoft.Extensions.Logging
Install-package Microsoft.Extensions.Logging.Console
Install-package Microsoft.Extensions.Hosting

```

### Update Program.cs
Add the following usings to the top of the file
```csharp
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;

```

In the Main method, replace
```csharp
Application.Run(new Form1());
```
with          
```csharp
            IHost host = Host.CreateDefaultBuilder()
                .ConfigureServices((hostContext, services) =>
                {
                    //  If you want configuration available for your services :
                    //  https://stackoverflow.com/questions/71480200/how-to-access-iconfiguration-provided-by-createdefaultbuilder-from-within-conf
                    var config = hostContext.Configuration;

                    services.AddLogging(configure => configure.AddDebug())
                    .AddScoped<Form1>()     // this puts the form under DI
                    ;
                    // configure other services here
                }).Build();

            var form1 = host.Services.GetRequiredService<Form1>();
            Application.Run(form1);
```

If you wish to use configuration
Add an application configuration file named appsettings.json
Set "Copy to Output Directory" property to "Copy if Newer"


### Update Form1.cs

Add variables to hold the values provided by Dependency Injection.  In this instance the logger
```csharp
private readonly ILogger _logger;
```

If you plan on using dependency injection, from within the form, include a variable to hold the host
```csharp
private readonly IHost _host;
```
        
Include all of the interfaces you will be leveraging on the form, in the constructor

```csharp
        public Form1(ILogger<Form1> logger, ColorChanger changer, IHost host)

        {
            _logger = logger;
            chg = changer;
            _host = host;
            InitializeComponent();
        }

        protected override void OnShown(EventArgs e)
        {
            base.OnShown(e);
            _logger.LogInformation("Form1 {BusinessLayerEvent} at {dateTime}", "Started", DateTime.UtcNow);
            chg.ChangeColor(this);
        }
```








Main article on DI
[https://www.thecodebuzz.com/dependency-injection-windows-form-desktop-app-net-core/](https://www.thecodebuzz.com/dependency-injection-windows-form-desktop-app-net-core/)
Adding logging via DI: (includes nuget pkg info) 
https://www.thecodebuzz.com/logging-net-core-forms-desktop-application/


This includes instructions for loading additional configuration file types
https://www.thecodebuzz.com/loading-configuration-ini-xml-json-net-core-console-winform/

