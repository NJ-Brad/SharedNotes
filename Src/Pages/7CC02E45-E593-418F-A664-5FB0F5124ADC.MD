# Create project
From the solution explorer, right click the project and select Open in terminal

https://learn.microsoft.com/en-us/ef/core/get-started/overview/install
At the Windows command shell
```
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
dotnet tool install --global dotnet-ef
dotnet add package Microsoft.EntityFrameworkCore.Design
```
 
Install EF Core Power Tools in Visual Studio
https://github.com/ErikEJ/EFCorePowerTools/
 
# Extracting data management to a class library
Create new class library project in main solution
At the command prompt, execute 
```
dotnet user-secrets init from the new project folder
```
Copy data classes to new library
Copy migrations to new library
Right-click project and select manage user secrets, on both the source project and the new library
Copy the contents of the secrets.json file from the main project to the data library secrets.json
Remove the file class1.cs from the new project
In the new project, change the namespace name of all classes that were copied
Add the following NuGet packages
Microsoft.Extensions.Configuration.UserSecrets
Microsoft.EntityFrameworkCore.SqlServer
Microsoft.EntityFrameworkCore.Tools
Adjust namespace of all migrations that were copied
add-migration AddedLib -project efgetstarteddatalib -startupproject efgetstarteddatalib
 
Using a Separate Migrations Project : https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations/projects?tabs=dotnet-core-cli
 
Add – New Project
Class library – Next
[Name] – Next
Create
Delete class1.cs from the project
Add the following NuGet packages to the project
Open package manager console
Select the new project as the default project
```
install-package Microsoft.Extensions.Configuration.UserSecrets
install-package Microsoft.EntityFrameworkCore
install-package Microsoft.EntityFrameworkCore.SqlServer
```
Or
```
install-package Microsoft.EntityFrameworkCore.Sqlite
install-package Microsoft.EntityFrameworkCore.Tools
```
Right-Click on the data project and select “Open in Terminal”
```
dotnet user-secrets init
dotnet user-secrets set "[ProjectName]:ConnectionString" "my connection string"
```

User secrets can be managed via command line or right-click on the project and select “Manage user secrets”
Add a new class to the data library [ProjectName]Context
Make the class public and change the base class to DbContext
```csharp
public class [ProjectName]Context : DbContext
Add a read-only property
public string DataSource { get; }
Create a constructor with the following code
        public PCDataContext()
        {
            var config = new ConfigurationBuilder().AddUserSecrets<[Class Name]>().Build();
 
            var secretProvider = config.Providers.First();
            secretProvider.TryGet("[ProjectName]:ConnectionString", out var secretPass);
 
            DataSource = secretPass;
        }
```
Add an override for the OnConfiguring method
```csharp
protected override void OnConfiguring(DbContextOptionsBuilder options)
        => options.UseSqlServer($"{DataSource}");
``` 
Add the following usings
```csharp
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
```
Compile the project to verify that everything is good, up to this point.
Create a new class, for a data model [name]Model
Change the visibility of the class to public
```csharp
    public class [name]Model
    {
        public string Id { get; set; } = Guid.NewGuid().ToString().Replace("-", "");
        public string FieldOne { get; set; }
        public string FieldTwo { get; set; }
    }
```
Make sure that there is a property named Id.  I like to use the initializer shown above, instead of waiting for the insert to complete, to get the identifier
Compile to test
Switch to the context class that you created previously
Add the new class as a DbSet  The name of the DbSet variable will be the name of the table.
```csharp
public DbSet<[classname]> [tablename] { get; set; }
```
Compile to test
From the package manager console:
```
Install-Package Microsoft.EntityFrameworkCore.Tools (first time only)
add-migration AddedLib -project [projectname] -startupproject [projectname]
```
(If the above completed successfully)
```
Update-Database -project [projectname] -startupproject [projectname]
```
From <https://d.docs.live.net/3183737ab4c8d728/Sql%20Server%20on%20Windows%20Server.docx> 

Go to main (data consuming) project
Add project reference, to data project

## Getting the generated query
```csharp
var v = context.Fragments;
string query = v.ToQueryString();
```
## Full Logging
https://stackoverflow.com/questions/41544006/is-there-any-context-database-log-in-net-core
https://learn.microsoft.com/en-us/ef/core/logging-events-diagnostics/
https://stackoverflow.com/questions/23804783/log-queries-executed-by-entity-framework-dbcontext

