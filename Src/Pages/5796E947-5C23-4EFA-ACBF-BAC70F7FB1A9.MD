# Introduction
Application.Restart must be called at the top level (not from within a form).  This article will provide a means to restart an application from any location.

# New Class
Add a class (RestartHandler) to your project
```csharp
    public class RestartHandler
    {
        public RestartHandler() { restartRequired = false; }

        private bool restartRequired = false;
        public void Set(bool restartNow = false)
        {
            restartRequired = true;
            if (restartNow)
            {
                Application.Exit();
            }
        }
        public void Clear() { restartRequired = false; }
        public void RestartIfRequired()
        {
            if (restartRequired)
                Application.Restart();
        }
        public void ExitIfRequired()
        {
            if (restartRequired)
                Application.Exit();
        }
    }
```
# Changes to Program.cs
Create an instance of the class, in program.cs
```csharp
        static void Main(string[] args)
        {
            RestartHandler restart = new();
```

In your dependency injection code, add a singleton
```csharp
.AddSingleton<RestartHandler>(restart)
```
At the end of your main class, add a call to handle restart logic
```csharp
                Application.Run(form1);

                restart.RestartIfRequired();
            }
```

# Preparing your class
Before you can utilize the restart handler, you need to include the singleton in your class.  This is best handled by creating a variable and setting it in the DI constructor

```csharp
        private RestartHandler? restart = null;

        public MyUglyForm(..., RestartHandler restart)
        {
            InitializeComponent();
            ...
            this.restart = restart;
        }
```

# Triggering restart
## Simple Approach
This approach will set and trigger the restart immediately
```csharp
            restart.Set(true);
```
## Advanced Approach
This approach gives you more flexibility in the timing of the restart
Where you determine that a restart is required call .Set
```csharp
            restart.Set();
```
If you later determine that the restart is no longer required call .Clear
```csharp
            restart.Clear();
```
When you reach the point where the restart should occur (if it is set) call .ExitIfRequired
```csharp
            restart.ExitIfRequired();
```
